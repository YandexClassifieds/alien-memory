
        <!DOCTYPE html>
        <html lang="ru" dir="ltr">
            <head>
                <meta charset="utf-8">
                <base href="../" />
                
                
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Region</title>
                <style type="text/css">
                    body {
                        height: 100vh;
                    }
                </style>
                <link type="text/css" rel="stylesheet" href="_bundle/vendor.css" />
<link type="text/css" rel="stylesheet" href="_bundle/app.css" />
                
                
            </head>
            <body class="g-root g-root_theme_light">
                <div id="root"></div>
                <script type="application/javascript">
                   window.STATIC_CONTENT = false
                   window.__DATA__ = {"data":{"meta":{"metadata":[],"style":[],"script":[],"csp":[]},"assets":[],"headings":[{"title":"Теги","href":"pages/regions.html#tegi","level":2,"items":[{"title":"Fresh","href":"pages/regions.html#fresh","level":3},{"title":"Named","href":"pages/regions.html#named","level":3},{"title":"Global","href":"pages/regions.html#global","level":3}]},{"title":"Арены","href":"pages/regions.html#areny","level":2,"items":[{"title":"Confined","href":"pages/regions.html#confined","level":3},{"title":"Shared","href":"pages/regions.html#shared","level":3},{"title":"Slicing","href":"pages/regions.html#slicing","level":3},{"title":"Custom","href":"pages/regions.html#custom","level":3}]}],"title":"Region","includes":[],"html":"<p>Для обеспечения безопасного доступа к памяти каждая выделенная область памяти привязывается к implicit scope, с типом <code>Region[R &lt;: Global]</code>.</p>\n<p><code>Region[R]</code> представляет собой обертку над <code>java.lang.foreign.Arena</code>. Регионы <code>confined</code>, <code>shared</code> и <code>slicing</code> соответствуют аренам из JDK, предоставляя различные уровни ограничения и доступа к выделенным областям памяти.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\"><span class=\"hljs-keyword\">val</span> layout = <span class=\"hljs-type\">Values</span>.<span class=\"hljs-type\">Int</span> * <span class=\"hljs-number\">100</span>\n<span class=\"hljs-keyword\">val</span> ptr = layout / % / $\n<span class=\"hljs-keyword\">val</span> leakedMemory = <span class=\"hljs-type\">Region</span>.fresh.confined { <span class=\"hljs-keyword\">implicit</span> region =&gt; \n  <span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocate(layout)\n\n  <span class=\"hljs-keyword\">for</span> (i &lt;- <span class=\"hljs-number\">0</span> until <span class=\"hljs-number\">100</span>) {\n    ptr.set(memory, -i, i)\n  }\n  memory\n}\n\n<span class=\"hljs-type\">Region</span>.fresh.confined { <span class=\"hljs-keyword\">implicit</span> region =&gt; \n  ptr.set(leakedMemory, <span class=\"hljs-number\">0</span>, i) <span class=\"hljs-comment\">// не скомпилируется</span>\n}\n\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"6\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-6\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-6\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-6.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h2 id=\"tegi\"><a href=\"pages/regions.html#tegi\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Теги</span></a>Теги</h2>\n<p>Каждая выделенная область памяти имеет тип-тег <code>R</code>, который соответствует параметру в <code>Region[R]</code>. Все аллокации сделанные с помошью <code>Region[R]</code>, будут иметь тот же тип-тег. Этот тип <code>R</code> является меткой для каждого региона памяти. Каждая метка наследуется от метки <code>Global</code>, которая применяется к выделениям памяти, сделанным не в безопасном режиме, выделенным сборщиком мусора или не подлежащим удалению.</p>\n<h3 id=\"fresh\"><a href=\"pages/regions.html#fresh\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Fresh</span></a>Fresh</h3>\n<p>Вы можете использовать метод <code>Region.fresh</code>, который автоматически генерирует уникальную метку во время компиляции, что полезно, если вы создаете множество регионов и хотите избежать конфликтов имен.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\"><span class=\"hljs-type\">Region</span>.fresh.confined { <span class=\"hljs-keyword\">implicit</span> region =&gt; \n  <span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocate(layout) <span class=\"hljs-comment\">// Memory[LayoutType, RandomComiletimeTag]</span>\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"19\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-19\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-19\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-19.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"named\"><a href=\"pages/regions.html#named\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Named</span></a>Named</h3>\n<p>Вы также можете явно указывать имена тегов.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\"><span class=\"hljs-type\">Region</span>.named[<span class=\"hljs-string\">\"ScopeName\"</span>].confined { <span class=\"hljs-keyword\">implicit</span> region =&gt; \n  <span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocate(layout) <span class=\"hljs-comment\">// Memory[LayoutType, NamedMark[\"ScopeName\"]]</span>\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"26\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-26\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-26\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-26.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"global\"><a href=\"pages/regions.html#global\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Global</span></a>Global</h3>\n<p>Глобальный тип-тег от которого наседуютяс все остальные теги. Вы можете переопределить глобальный тип-тег с помощью метода <code>Region.newGlobal</code>, обернув какую-то область памяти. По умолчанию этот тип соответствует <code>Arena.global()</code> из <code>java.lang.foreign</code>.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\"><span class=\"hljs-keyword\">val</span> customArena = ...\n<span class=\"hljs-keyword\">implicit</span> <span class=\"hljs-keyword\">val</span> newGlobalArena = <span class=\"hljs-type\">Region</span>.newGlobal(customArena)\n\n<span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocateGlobal(layout)\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"33\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-33\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-33\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-33.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h2 id=\"areny\"><a href=\"pages/regions.html#areny\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Арены</span></a>Арены</h2>\n<p>Внутри каждого региона находится объект <code>Arena</code> из пакета <code>java.lang.foreign</code>. Каждая арена определяет свои уровни ограничений и имеет различные стратегии выделения и освобождения памяти.</p>\n<h3 id=\"confined\"><a href=\"pages/regions.html#confined\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Confined</span></a>Confined</h3>\n<p>Все аллокации памяти, выполненные с помощью такого региона, будут доступны только из потока, который их произвел. Такие аллокации и освобождения памяти производятся быстрее по сравнению с ареной, доступной из разных потоков.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\">\n<span class=\"hljs-type\">Region</span>.fresh.confined { <span class=\"hljs-keyword\">implicit</span> region =&gt;\n  <span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocate(layout)\n  ptr.get(memory, <span class=\"hljs-number\">0</span>)\n  <span class=\"hljs-keyword\">val</span> anotherThread = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-type\">Thread</span> {\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">run</span></span>(): <span class=\"hljs-type\">Unit</span> =\n      ptr.get(memory, <span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">// выкинет ошибку</span>\n  }\n  anotherThread.start()\n  anotherThread.join()\n}\n\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"46\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-46\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-46\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-46.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"shared\"><a href=\"pages/regions.html#shared\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Shared</span></a>Shared</h3>\n<p>Все аллокации памяти, выполненные с помощью такого региона, будут доступны из любого потока. Такие аллокации и освобождения памяти производятся медление по сравнению с ареной, доступной из одного потока.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\">\n<span class=\"hljs-type\">Region</span>.fresh.shared { <span class=\"hljs-keyword\">implicit</span> region =&gt;\n  <span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocate(layout)\n  ptr.get(memory, <span class=\"hljs-number\">0</span>)\n  <span class=\"hljs-keyword\">val</span> anotherThread = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-type\">Thread</span> {\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">run</span></span>(): <span class=\"hljs-type\">Unit</span> =\n      ptr.get(memory, <span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">// все будет работать</span>\n  }\n  anotherThread.start()\n  anotherThread.join()\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"53\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-53\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-53\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-53.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"slicing\"><a href=\"pages/regions.html#slicing\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Slicing</span></a>Slicing</h3>\n<p><code>Slicing</code> будет выполнять аллокации последовательно на заранее выделенном участке памяти. Такой участок памяти может находиться как в <code>confined</code>, так и в <code>shared</code> арене. Однако сами аллокации в такой арене не являются потокобезопасными.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\"><span class=\"hljs-keyword\">val</span> layout1 = <span class=\"hljs-type\">Values</span>.<span class=\"hljs-type\">Long</span> * <span class=\"hljs-number\">16</span>\n<span class=\"hljs-keyword\">val</span> layout2 = <span class=\"hljs-type\">Values</span>.<span class=\"hljs-type\">Char</span> * <span class=\"hljs-number\">12</span>\n<span class=\"hljs-type\">Region</span>.fresh.confinedSlicing(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">8</span>) { <span class=\"hljs-keyword\">implicit</span> region =&gt; \n  <span class=\"hljs-keyword\">val</span> memory1 = <span class=\"hljs-type\">Memory</span>.allocate(layout1) <span class=\"hljs-comment\">// в начале преаллоцированной памяти разместится первый сегмент</span>\n  <span class=\"hljs-keyword\">val</span> memory2 = <span class=\"hljs-type\">Memory</span>.allocate(layout2) <span class=\"hljs-comment\">// этот сегмент разместится сразу после</span>\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"60\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-60\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-60\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-60.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"custom\"><a href=\"pages/regions.html#custom\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Custom</span></a>Custom</h3>\n<p>Так-же в регион можно обернуть любую собственную арену.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"hljs scala\"><span class=\"hljs-keyword\">val</span> newCustomArena = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-type\">Arena</span> { ... }\n<span class=\"hljs-type\">Region</span>.fresh.custom(newCustomArena) { <span class=\"hljs-keyword\">implicit</span> region =&gt; \n  <span class=\"hljs-keyword\">val</span> memory = <span class=\"hljs-type\">Memory</span>.allocate(layout) <span class=\"hljs-comment\">// в начале преаллоцированной памяти разместится первый сегмент</span>\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"67\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-67\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-67\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-67.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n","leading":false},"router":{"pathname":"pages/regions","depth":2},"lang":"ru","langs":["ru"]};
                </script>
                <script src="toc.js" type="application/javascript"></script>
                <script type="application/javascript" src="_bundle/react.js"></script>
<script type="application/javascript" src="_bundle/app.js"></script>
<script type="application/javascript" src="_bundle/vendor.js"></script>
            </body>
        </html>
    