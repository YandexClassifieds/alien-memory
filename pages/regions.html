
        <!DOCTYPE html>
        <html lang="ru" dir="ltr">
            <head>
                <meta charset="utf-8">
                <base href="../" />
                
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Region</title>
                <style type="text/css">
                    body {
                        height: 100vh;
                    }
                </style>
                <link type="text/css" rel="stylesheet" href="_bundle/vendor.css" />
<link type="text/css" rel="stylesheet" href="_bundle/app.css" />
                
                
            </head>
            <body class="g-root g-root_theme_light">
                <div id="root"></div>
                <script type="application/javascript">
                   window.STATIC_CONTENT = false
                   window.__DATA__ = {"data":{"meta":{"metadata":[],"style":[],"script":[]},"assets":[],"headings":[{"title":"Tags","href":"pages/regions.html#tags","level":2,"items":[{"title":"Fresh","href":"pages/regions.html#fresh","level":3},{"title":"Named","href":"pages/regions.html#named","level":3},{"title":"Global","href":"pages/regions.html#global","level":3}]},{"title":"Arenas","href":"pages/regions.html#arenas","level":2,"items":[{"title":"Confined","href":"pages/regions.html#confined","level":3},{"title":"Shared","href":"pages/regions.html#shared","level":3},{"title":"Slicing","href":"pages/regions.html#slicing","level":3},{"title":"Custom","href":"pages/regions.html#custom","level":3}]}],"title":"Region","includes":[],"html":"<p>To ensure safe memory access, every allocated memory region is bound to an implicit scope with <code>Region[R &lt;: Global]</code> type.</p>\n<p><code>Region[R]</code> is a wrapper over <code>java.lang.foreign.Arena</code>. The <code>confined</code>, <code>shared</code> and <code>slicing</code> regions match JDK arenas,<br />\nproviding various level's of confinement and access to allocated memory.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">val layout = Values.Int * 100\nval ptr = layout / % / $\nval leakedMemory = Region.fresh.confined { implicit region =&gt;\n  val memory = Memory.allocate(layout)\n\n  for (i &lt;- 0 until 100) {\n    ptr.set(memory, -i, i)\n  }\n  memory\n}\n\nRegion.fresh.confined { implicit region =&gt;\n  ptr.set(leakedMemory, 0, i) // won't compile\n}\n\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"6\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-6\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-6\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-6.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h2 id=\"tags\"><a href=\"pages/regions.html#tags\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Tags</span></a>Tags</h2>\n<p>Each allocated memory region has a type tag <code>R</code>, matching a type parameter in <code>Region[R]</code>. All allocations made with<br />\n<code>Region[R]</code> will have the same type tag. This type <code>R</code> serves as a label for each memory region. Every tag is a descendant<br />\nof the <code>Global</code> tag which is applied to memory allocations made in an unsafe mode, not managed by GC and that are never<br />\ndeallocated. See <a href=\"https://docs.oracle.com/en/java/javase/22/core/memory-segments-and-arenas.html\" target=\"_blank\" rel=\"noreferrer noopener\">documentation of Arenas for more detailed info</a></p>\n<h3 id=\"fresh\"><a href=\"pages/regions.html#fresh\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Fresh</span></a>Fresh</h3>\n<p><code>Region.fresh</code> generates a unique label at compile time. That's particularly useful if many regions are going to be allocated<br />\nto avoid name conflicts.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">Region.fresh.confined { implicit region =&gt;\n  val memory = Memory.allocate(layout) // Memory[LayoutType, RandomCompiletimeTag]\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"19\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-19\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-19\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-19.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"named\"><a href=\"pages/regions.html#named\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Named</span></a>Named</h3>\n<p>Tag names can be specified explicitly.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">Region.named[\"ScopeName\"].confined { implicit region =&gt;\n  val memory = Memory.allocate(layout) // Memory[LayoutType, NamedMark[\"ScopeName\"]]\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"26\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-26\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-26\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-26.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"global\"><a href=\"pages/regions.html#global\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Global</span></a>Global</h3>\n<p>Parent type tag for all the other tags. Global type tag can be overrided using <code>Region.newGlobal</code> method, providing<br />\na specific memory segment. By default, same as <code>Arena.global()</code> from <code>java.lang.foreign</code>.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">val customArena = ...\nimplicit val newGlobalArena = Region.newGlobal(customArena)\n\nval memory = Memory.allocateGlobal(layout)\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"33\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-33\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-33\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-33.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h2 id=\"arenas\"><a href=\"pages/regions.html#arenas\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Arenas</span></a>Arenas</h2>\n<p>Every <code>Region</code> contains <code>java.lang.foreign.Arena</code>. There are several types of arenas, each with their own confinement levels<br />\nand strategies for allocation and de-allocation. For detailed info, please refer to <a href=\"https://docs.oracle.com/en/java/javase/22/core/memory-segments-and-arenas.html\" target=\"_blank\" rel=\"noreferrer noopener\">official Java FFM API docs</a></p>\n<h3 id=\"confined\"><a href=\"pages/regions.html#confined\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Confined</span></a>Confined</h3>\n<p>All allocations, made with such region will be available only from owner thread.<br />\nSuch allocations and de-allocations are faster than shared arenas.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">\nRegion.fresh.confined { implicit region =&gt;\n  val memory = Memory.allocate(layout)\n  ptr.get(memory, 0)\n  val anotherThread = new Thread {\n    override def run(): Unit =\n      ptr.get(memory, 0) // throws error\n  }\n  anotherThread.start()\n  anotherThread.join()\n}\n\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"46\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-46\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-46\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-46.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"shared\"><a href=\"pages/regions.html#shared\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Shared</span></a>Shared</h3>\n<p>Shared region allocations are available for every thread. Allocations and de-allocations are slower compared to confined regions.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">\nRegion.fresh.shared { implicit region =&gt;\n  val memory = Memory.allocate(layout)\n  ptr.get(memory, 0)\n  val anotherThread = new Thread {\n    override def run(): Unit =\n      ptr.get(memory, 0) // works fine\n  }\n  anotherThread.start()\n  anotherThread.join()\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"53\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-53\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-53\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-53.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"slicing\"><a href=\"pages/regions.html#slicing\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Slicing</span></a>Slicing</h3>\n<p><code>Slicing</code>  will do consecutive allocations within the pre-allocated memory region. Such region can be in either <code>confined</code> or<br />\n<code>shared</code> Arena. Such allocations are not thread safe.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">val layout1 = Values.Long * 16\nval layout2 = Values.Char * 12\nRegion.fresh.confinedSlicing(128, 8) { implicit region =&gt;\n  val memory1 = Memory.allocate(layout1) // the first segment will be at the beginning of pre-allocated memory\n  val memory2 = Memory.allocate(layout2) // this segment will be right after the first\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"60\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-60\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-60\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-60.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n<h3 id=\"custom\"><a href=\"pages/regions.html#custom\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\" data-no-index=\"true\">Custom</span></a>Custom</h3>\n<p>Region can be used with any custom arena.</p>\n\n    <div class=\"yfm-clipboard\">\n        <pre><code class=\"language-scala\">val newCustomArena = new Arena { ... }\nRegion.fresh.custom(newCustomArena) { implicit region =&gt;\n  val memory = Memory.allocate(layout)\n}\n</code></pre>\n\n        <button class=\"yfm-clipboard-button\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-icon\" data-animation=\"67\">\n                <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n                <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n                    <animate id=\"visibileAnimation-67\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n                    <animate id=\"hideAnimation-67\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-67.end+1\" fill=\"freeze\"></animate>\n                </path>\n            </svg>\n        </button>\n    </div>\n","leading":false},"router":{"pathname":"pages/regions","depth":2},"lang":"ru","langs":["ru"]};
                </script>
                <script src="toc.js" type="application/javascript"></script>
                <script type="application/javascript" src="_bundle/react.js"></script>
<script type="application/javascript" src="_bundle/app.js"></script>
<script type="application/javascript" src="_bundle/vendor.js"></script>
            </body>
        </html>
    